<%= form_with model: callback, 
              url: callback.persisted? ? callback_path(callback) : callbacks_path,
              method: callback.persisted? ? :patch : :post,
              local: false, 
              class: "mcm-form",
              id: callback.persisted? ? "edit_callback_#{callback.id}" : "new_callback",
              data: { 
                controller: "callback-form",
                callback_form_target: "form",
                turbo_frame: "main_content",
                action: "turbo:submit-start->callback-form#handleSubmit turbo:submit-end->callback-form#handleSuccess"
              } do |form| %>

  <!-- Contact Information -->
  <div class="mcm-section">
    <div class="mcm-field">
      <div class="mcm-input-group">
        <i class="mcm-input-icon fas fa-phone"></i>
        <%= form.telephone_field :phone_number, 
                                 class: "mcm-input", 
                                 placeholder: "Phone Number",
                                 autofocus: true,
                                 data: { 
                                   callback_form_target: "phoneNumber",
                                   action: "input->callback-form#formatPhone"
                                 } %>
      </div>
    </div>

    <div class="mcm-field">
      <div class="mcm-input-group">
        <i class="mcm-input-icon fas fa-user"></i>
        <%= form.text_field :customer_name, 
                            class: "mcm-input", 
                            placeholder: "Customer Name" %>
      </div>
    </div>

    <div class="mcm-field">
      <div class="mcm-input-group">
        <i class="mcm-input-icon fas fa-cog"></i>
        <%= form.text_field :product, 
                           class: "mcm-input", 
                           placeholder: "Part Name" %>
      </div>
    </div>
  </div>

  <!-- Vehicle Information -->
  <div class="mcm-section">
    <div class="mcm-field-row">
      <div class="mcm-field">
        <div class="mcm-input-group">
          <i class="mcm-input-icon fas fa-car"></i>
          <%= form.text_field :car_make_model, 
                              class: "mcm-input", 
                              placeholder: "Make & Model" %>
        </div>
      </div>
      
      <div class="mcm-field">
        <div class="mcm-input-group">
          <i class="mcm-input-icon fas fa-calendar"></i>
          <%= form.number_field :year, 
                                class: "mcm-input", 
                                placeholder: "Year" %>
        </div>
      </div>
    </div>

    <div class="mcm-field">
      <div class="mcm-input-group">
        <i class="mcm-input-icon fas fa-map-marker-alt"></i>
        <%= form.text_field :zip_code, 
                            class: "mcm-input", 
                            placeholder: "ZIP Code" %>
      </div>
    </div>
  </div>

  <!-- Status Selection -->
  <div class="mcm-section">
    <div class="mcm-status-grid">
      <label class="mcm-status-option">
        <%= form.radio_button :status, 'pending', 
                              checked: (callback.status || 'pending') == 'pending',
                              data: { action: "change->callback-form#updateStatus" } %>
        <div class="mcm-status-card">
          <i class="mcm-status-icon fas fa-clock"></i>
          <span class="mcm-status-label">Pending</span>
        </div>
      </label>
      
      <label class="mcm-status-option">
        <%= form.radio_button :status, 'follow_up', 
                              data: { action: "change->callback-form#updateStatus" } %>
        <div class="mcm-status-card">
          <i class="mcm-status-icon fas fa-phone"></i>
          <span class="mcm-status-label">Follow Up</span>
        </div>
      </label>
      
      <label class="mcm-status-option">
        <%= form.radio_button :status, 'payment_link', 
                              data: { action: "change->callback-form#updateStatus" } %>
        <div class="mcm-status-card">
          <i class="mcm-status-icon fas fa-credit-card"></i>
          <span class="mcm-status-label">Payment Link</span>
        </div>
      </label>
      
      <label class="mcm-status-option">
        <%= form.radio_button :status, 'not_interested', 
                              data: { action: "change->callback-form#updateStatus" } %>
        <div class="mcm-status-card">
          <i class="mcm-status-icon fas fa-times"></i>
          <span class="mcm-status-label">Not Interested</span>
        </div>
      </label>
    </div>
  </div>

  <!-- Follow-up Date -->
  <div class="mcm-section" data-callback-form-target="followupSection">
    <div class="mcm-date-section">
      <div class="mcm-date-buttons">
        <button type="button" class="mcm-date-btn" 
                data-action="click->callback-form#setFollowupDate" 
                data-days="0">
          <i class="mcm-date-icon fas fa-sun"></i>
          <span>Today</span>
        </button>
        
        <button type="button" class="mcm-date-btn" 
                data-action="click->callback-form#setFollowupDate" 
                data-days="1">
          <i class="mcm-date-icon fas fa-arrow-right"></i>
          <span>Tomorrow</span>
        </button>
        
        <button type="button" class="mcm-date-btn" 
                data-action="click->callback-form#setFollowupDate" 
                data-days="7">
          <i class="mcm-date-icon fas fa-calendar-week"></i>
          <span>Next Week</span>
        </button>
        
        <button type="button" class="mcm-date-btn" 
                data-action="click->callback-form#showCustomDate">
          <i class="mcm-date-icon fas fa-calendar-alt"></i>
          <span>Custom</span>
        </button>
      </div>
      
      <%= form.date_field :follow_up_date, 
                          class: "mcm-date-input", 
                          value: callback.follow_up_date || (Date.current + 1.day),
                          data: { callback_form_target: "followupDateInput" } %>
    </div>
  </div>

  <!-- Hidden Fields -->
  <% unless callback.persisted? %>
    <%= form.hidden_field :agent, value: current_user.email %>
  <% end %>
<% end %>

<!-- Actions -->
<div class="mcm-actions">
  <%= link_to "Cancel", callbacks_path, class: "mcm-btn mcm-btn-cancel", 
      data: { turbo_frame: turbo_frame_request? ? "main_content" : "_top" } %>
  
  <%= button_tag callback.persisted? ? "Update" : "Save", 
      type: "submit", 
      form: callback.persisted? ? "edit_callback_#{callback.id}" : "new_callback",
      class: "mcm-btn mcm-btn-save", 
      data: { callback_form_target: "submitBtn" } %>
</div>