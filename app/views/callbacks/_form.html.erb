<%= form_with model: callback, 
              url: callback.persisted? ? callback_path(callback) : callbacks_path,
              method: callback.persisted? ? :patch : :post,
              local: false, 
              class: "quick-callback-form", 
              data: { 
                callback_form_target: "form",
                turbo_frame: "main_content",
                action: "turbo:submit-start->callback-form#handleSubmit turbo:submit-end->callback-form#handleSuccess"
              } do |form| %>
  
  <!-- Error Messages -->
  <% if callback.errors.any? %>
    <div class="quick-form-alert">
      <i class="fas fa-exclamation-triangle"></i>
      <span>Please fix the highlighted fields below</span>
    </div>
  <% end %>

  <!-- Primary Info Card -->
  <div class="quick-form-card">
    <div class="quick-form-header">
      <h3>Customer & Contact</h3>
      <span class="quick-badge">Required</span>
    </div>
    
    <div class="quick-form-row">
      <div class="quick-input-group">
        <%= form.text_field :customer_name, 
                            class: "quick-input", 
                            placeholder: "Customer Name *", 
                            required: true,
                            data: { action: "input->callback-form#validateField" } %>
      </div>
      
      <div class="quick-input-group">
        <%= form.telephone_field :phone_number, 
                                 class: "quick-input", 
                                 placeholder: "Phone Number *", 
                                 required: true,
                                 data: { 
                                   callback_form_target: "phoneNumber",
                                   action: "input->callback-form#formatPhone input->callback-form#validateField"
                                 } %>
      </div>
      
      <div class="quick-input-group">
        <%= form.text_field :zip_code, 
                            class: "quick-input", 
                            placeholder: "ZIP Code (Optional)" %>
      </div>
    </div>
  </div>

  <!-- Vehicle & Product Card -->
  <div class="quick-form-card">
    <div class="quick-form-header">
      <h3>Vehicle & Product</h3>
      <span class="quick-badge quick-badge-secondary">Details</span>
    </div>
    
    <div class="quick-form-row">
      <div class="quick-input-group">
        <%= form.text_field :car_make_model, 
                            class: "quick-input", 
                            placeholder: "Car Make & Model *", 
                            required: true,
                            data: { action: "input->callback-form#validateField" } %>
      </div>
      
      <div class="quick-input-group quick-input-small">
        <%= form.number_field :year, 
                              class: "quick-input", 
                              placeholder: "Year",
                              min: 1930,
                              max: 2030,
                              value: "" %>
      </div>
    </div>
    
    <div class="quick-form-row">
      <div class="quick-input-group quick-input-full">
        <%= form.text_field :product, 
                           class: "quick-input", 
                           placeholder: "Product Description *", 
                           required: true,
                           data: { action: "input->callback-form#validateField" } %>
      </div>
    </div>
  </div>

  <!-- Callback Setup Card -->
  <div class="quick-form-card">
    <div class="quick-form-header">
      <h3>Callback Setup</h3>
      <span class="quick-badge quick-badge-accent">Schedule</span>
    </div>
    
    <!-- Status Quick Selection -->
    <div class="quick-status-grid">
      <div class="quick-status-option" data-status="pending">
        <input type="radio" name="agent_callback[status]" value="pending" id="status_pending" 
               <%= 'checked' if (callback.status || 'pending') == 'pending' %>
               data-action="change->callback-form#updateStatus">
        <label for="status_pending">
          <i class="fas fa-clock"></i>
          <span>Pending</span>
        </label>
      </div>
      
      <div class="quick-status-option" data-status="follow_up">
        <input type="radio" name="agent_callback[status]" value="follow_up" id="status_follow_up"
               <%= 'checked' if callback.status == 'follow_up' %>
               data-action="change->callback-form#updateStatus">
        <label for="status_follow_up">
          <i class="fas fa-phone"></i>
          <span>Follow Up</span>
        </label>
      </div>
      
      <div class="quick-status-option" data-status="sale">
        <input type="radio" name="agent_callback[status]" value="sale" id="status_sale"
               <%= 'checked' if callback.status == 'sale' %>
               data-action="change->callback-form#updateStatus">
        <label for="status_sale">
          <i class="fas fa-handshake"></i>
          <span>Sale</span>
        </label>
      </div>
      
      <div class="quick-status-option" data-status="not_interested">
        <input type="radio" name="agent_callback[status]" value="not_interested" id="status_not_interested"
               <%= 'checked' if callback.status == 'not_interested' %>
               data-action="change->callback-form#updateStatus">
        <label for="status_not_interested">
          <i class="fas fa-times"></i>
          <span>Not Interested</span>
        </label>
      </div>
      
      <div class="quick-status-option" data-status="already_purchased">
        <input type="radio" name="agent_callback[status]" value="already_purchased" id="status_already_purchased"
               <%= 'checked' if callback.status == 'already_purchased' %>
               data-action="change->callback-form#updateStatus">
        <label for="status_already_purchased">
          <i class="fas fa-check-circle"></i>
          <span>Already Purchased</span>
        </label>
      </div>
      
      <div class="quick-status-option" data-status="payment_link">
        <input type="radio" name="agent_callback[status]" value="payment_link" id="status_payment_link"
               <%= 'checked' if callback.status == 'payment_link' %>
               data-action="change->callback-form#updateStatus">
        <label for="status_payment_link">
          <i class="fas fa-credit-card"></i>
          <span>Payment Link</span>
        </label>
      </div>
    </div>
    
    <!-- Follow-up Date Selection -->
    <div class="quick-followup-section" data-callback-form-target="followupSection">
      <div class="quick-form-label">Follow-up Date</div>
      
      <!-- Quick Date Buttons -->
      <div class="quick-date-options">
        <button type="button" class="quick-date-btn" 
                data-action="click->callback-form#setFollowupDate" 
                data-days="0">
          <span>Today</span>
          <small><%= Date.current.strftime("%m/%d") %></small>
        </button>
        
        <button type="button" class="quick-date-btn" 
                data-action="click->callback-form#setFollowupDate" 
                data-days="1">
          <span>Tomorrow</span>
          <small><%= (Date.current + 1.day).strftime("%m/%d") %></small>
        </button>
        
        <button type="button" class="quick-date-btn" 
                data-action="click->callback-form#setFollowupDate" 
                data-days="3">
          <span>3 Days</span>
          <small><%= (Date.current + 3.days).strftime("%m/%d") %></small>
        </button>
        
        <button type="button" class="quick-date-btn" 
                data-action="click->callback-form#setFollowupDate" 
                data-days="7">
          <span>1 Week</span>
          <small><%= (Date.current + 1.week).strftime("%m/%d") %></small>
        </button>
        
        <button type="button" class="quick-date-btn quick-date-custom" 
                data-action="click->callback-form#showCustomDate">
          <i class="fas fa-calendar-alt"></i>
          <span>Custom</span>
        </button>
      </div>
      
      <!-- Hidden Date Input -->
      <%= form.date_field :follow_up_date, 
                          class: "quick-date-input", 
                          value: callback.follow_up_date || (Date.current + 1.day),
                          data: { callback_form_target: "followupDateInput" } %>
    </div>
    
    <!-- Agent Assignment (Auto for new) -->
    <% unless callback.persisted? %>
      <%= form.hidden_field :agent, value: current_user.email %>
      <div class="quick-agent-info">
        <i class="fas fa-user-check"></i>
        <span>Assigned to you (<%= current_user.email %>)</span>
      </div>
    <% else %>
      <div class="quick-input-group">
        <%= form.select :agent, options_from_collection_for_select(User.all, :email, :email, callback.agent), 
            { prompt: 'Select agent' }, { class: "quick-select" } %>
      </div>
    <% end %>
  </div>

  <!-- Quick Communication Card -->
  <div class="quick-form-card">
    <div class="quick-form-header">
      <h3>Quick Communication</h3>
      <span class="quick-badge quick-badge-info">Team</span>
    </div>
    
    <div class="quick-input-group quick-input-full">
      <%= text_area_tag :communication_message, "", 
                         class: "quick-textarea", 
                         rows: 2, 
                         placeholder: "Add note or @mention team members..." %>
    </div>
    
    <div class="communication-options">
      <label class="quick-checkbox">
        <%= check_box_tag :notify_team %>
        <span>Notify team members</span>
      </label>
      <label class="quick-checkbox">
        <%= check_box_tag :mark_urgent %>
        <span>Mark as urgent</span>
      </label>
      
      <div class="message-type-selector">
        <%= select_tag :message_type, 
            options_for_select([
              ['Internal Note', 'note'],
              ['Customer Update', 'customer_update'],
              ['Follow-up Required', 'follow_up'],
              ['Assignment Change', 'assignment']
            ], 'note'), 
            { class: "quick-select" } %>
      </div>
    </div>
  </div>
  
  <!-- Quick Actions -->
  <div class="quick-form-actions">
    <%= link_to "Cancel", callbacks_path, class: "quick-btn quick-btn-secondary", 
        data: { turbo_frame: turbo_frame_request? ? "main_content" : "_top" } %>
    
    <%= form.submit callback.persisted? ? "Update Callback" : "Save Callback", 
        class: "quick-btn quick-btn-primary", 
        data: { callback_form_target: "submitBtn" } %>
  </div>
<% end %>