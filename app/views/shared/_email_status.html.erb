<% if last_result&.key?(:success) %>
  <div class="alert alert-<%= last_result[:success] ? 'success' : 'danger' %> alert-dismissible fade show" role="alert">
    <i class="<%= last_result[:success] ? 'fas fa-check-circle' : 'fas fa-exclamation-triangle' %>"></i>
    <strong>Email Status:</strong> <%= last_result[:message] || last_result[:error] %>
    <small class="d-block mt-1">
      <i class="fas fa-clock"></i>
      Just now
    </small>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
<% end %>

<!-- Recent Email Activity from Timeline -->
<% email_activities = order.activities.where(action: ['confirmation_email_sent', 'shipping_email_sent', 'follow_up_email_sent']).limit(3) %>
<% if email_activities.any? %>
  <div class="recent-emails mt-2">
    <h6 class="small text-muted mb-2">
      <i class="fas fa-history"></i>
      Recent Email Activity
    </h6>
    <% email_activities.each do |activity| %>
      <div class="email-history-item mb-2 p-2 bg-light rounded">
        <div class="d-flex justify-content-between align-items-start">
          <div>
            <span class="badge badge-sm bg-success">
              <%= activity.action.humanize.gsub('sent', '') %>
            </span>
            <small class="text-muted d-block">
              To: <%= activity.new_value %>
            </small>
          </div>
          <small class="text-muted">
            <%= time_ago_in_words(activity.created_at) %> ago
          </small>
        </div>
      </div>
    <% end %>
  </div>
<% end %>