<%= turbo_frame_tag "main_content", data: { turbo_action: "advance" } do %>
<% content_for :title, "Refunds Management" %>

<div class="refunds-modern-container">
  <!-- Modern Header Hero Section -->
  <div class="refunds-hero-section">
    <div class="refunds-hero-content">
      <div class="refunds-hero-left">
        <div class="refunds-hero-icon">
          <i class="fas fa-undo-alt"></i>
        </div>
        <div class="refunds-hero-text">
          <h1 class="refunds-hero-title">Refunds</h1>
          <p class="refunds-hero-subtitle">Process returns & manage customer satisfaction</p>
        </div>
      </div>
      
      <div class="refunds-hero-stats">
        <div class="refunds-stat-card">
          <div class="refunds-stat-number"><%= @refunds.count %></div>
          <div class="refunds-stat-label">Total</div>
        </div>
        <div class="refunds-stat-card refunds-stat-pending">
          <div class="refunds-stat-number"><%= @refunds.select { |r| r.refund_stage == 'pending_refund' }.count %></div>
          <div class="refunds-stat-label">Pending</div>
        </div>
        <div class="refunds-stat-card refunds-stat-urgent">
          <div class="refunds-stat-number"><%= @refunds.select { |r| r.sla_status == 'breached' }.count %></div>
          <div class="refunds-stat-label">Urgent</div>
        </div>
      </div>
      
      <div class="refunds-hero-actions">
        <%= link_to sla_analytics_refunds_path, class: "refunds-btn refunds-btn-primary" do %>
          <i class="fas fa-chart-line"></i>
          <span>Analytics</span>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Modern Filter Bar -->
  <div class="refunds-filter-bar">
    <%= form_with url: refunds_path, method: :get, local: true, class: "refunds-filter-form" do |form| %>
      <div class="refunds-search-input">
        <i class="fas fa-search"></i>
        <%= form.text_field :search, 
              placeholder: "Search refunds...", 
              value: params[:search],
              class: "refunds-search-field" %>
      </div>
      
      <div class="refunds-filter-group">
        <%= form.select :stage, 
              options_for_select([['All Stages', '']] + @stages.map { |s| [s.humanize, s] }, params[:stage]),
              {}, 
              { class: "refunds-filter-select" } %>
        
        <%= form.select :reason, 
              options_for_select([['All Reasons', '']] + @reasons.map { |r| [r.humanize, r] }, params[:reason]),
              {}, 
              { class: "refunds-filter-select" } %>
        
        <%= form.select :priority, 
              options_for_select([['All Priorities', '']] + @priorities.map { |p| [p.humanize, p] }, params[:priority]),
              {}, 
              { class: "refunds-filter-select" } %>
        
        <%= form.select :agent_id, 
              options_for_select([['All Agents', '']] + @agents.map { |a| [a.email, a.id] }, params[:agent_id]),
              {}, 
              { class: "refunds-filter-select" } %>
      </div>
      
      <div class="refunds-filter-actions">
        <%= form.submit "Filter", class: "refunds-btn refunds-btn-filter" %>
        <%= link_to "Clear", refunds_path, class: "refunds-btn refunds-btn-clear" %>
      </div>
    <% end %>
  </div>

  <!-- Modern Refunds Grid -->
  <div class="refunds-grid-container">
    <div id="refunds-content">
      <%= render 'refunds_content', refunds: @refunds %>
    </div>
  </div>
</div>

<!-- Subscribe to Turbo broadcasts -->
<%= turbo_stream_from "refunds" %>
<% end %>